(function(){var t=[].slice,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function s(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t};!function(t,e){return"function"==typeof define&&define.amd?define(function(){return e(t)}):t.NeatComplete=e(t)}(this,function(){var i;return i={},i.addDomEvent=function(t,e,i){return null!=t.attachEvent?(t["e"+e+i]=i,t[""+e+i]=function(){return t["e"+e+i](window.event)},t.attachEvent("on"+e,t[""+e+i])):t.addEventListener(e,i,!1)},i.removeDomEvent=function(t,e,i){return null!=t.detachEvent?t.detachEvent("on"+e,t[""+e+i]):t.removeEventListener(e,i,!1)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e,i,s,n;if("undefined"==typeof this||null===this)throw new TypeError;if(n=Object(this),i=n.length>>>0,0===i)return-1;if(s=0,arguments.length>0&&(s=Number(arguments[1]),s!==s?s=0:0!==s&&1/0!==s&&s!==-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=i)return-1;for(e=s>=0?s:Math.max(i-Math.abs(s),0);i>e;){if(e in n&&n[e]===t)return e;e++}return-1}),i.Dispatch=function(){function e(){}return e.prototype.setOption=function(t,e){return this.options[t]=e,this},e.prototype.getOption=function(t){return this.options[t]},e.prototype.on=function(t,e){var i;return null==this.subs&&(this.subs={}),null==(i=this.subs)[t]&&(i[t]=[]),this.subs[t].push(e),this},e.prototype.trigger=function(){var e,i,s,n,o,r,h;if(s=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(null!=(r=this.subs)?r[s]:void 0))for(h=this.subs[s],n=0,o=h.length;o>n;n++)i=h[n],i.apply(this,e);return this},e}(),i.Widget=function(t){function n(t,i){this.element=t,this.options=null!=i?i:{},this._onBlur=e(this._onBlur,this),this._onKeyDown=e(this._onKeyDown,this),this._onKeyPress=e(this._onKeyPress,this),this._onFocus=e(this._onFocus,this),this.enabled=!0,this.element.setAttribute("autocomplete","off"),this.services=[],this._applyDefaults(),null==this.getOption("container")&&this.setOption("container",window.document.body),this._addListeners(),this.output=document.createElement("ul"),this.output.className=this.options.list_class,this._applyStyle("display","none"),this._applyStyle("position",this.options.position),this.options.container.appendChild(this.output)}return s(n,t),n.prototype.defaults={max_results:10,list_class:"nc_list",item_class:"nc_item",hover_class:"nc_hover",footer_class:"nc_footer",empty_class:"nc_empty",error_class:"nc_error",position:"absolute"},n.prototype.addService=function(t,e,s){var n;return null==s&&(s={}),this.services.push(n=new i.Service(this,t,e,s)),n},n.prototype.disable=function(){return this.enabled=!1,this},n.prototype.enable=function(){return this.enabled=!0,this},n.prototype.destroy=function(){document.body.removeChild(this.output),this.element.removeAttribute("autocomplete")},n.prototype._applyDefaults=function(){var t,e,i,s;i=this.defaults,s=[];for(t in i)e=i[t],s.push(null==this.getOption(t)?this.setOption(t,e):void 0);return s},n.prototype._addListeners=function(){return i.addDomEvent(this.element,"focus",this._onFocus),i.addDomEvent(this.element,"keypress",this._onKeyPress),i.addDomEvent(this.element,"keydown",this._onKeyDown),i.addDomEvent(this.element,"blur",this._onBlur)},n.prototype._removeListeners=function(){return i.removeDomEvent(this.element,"focus",this._onFocus),i.removeDomEvent(this.element,"keypress",this._onKeyPress),i.removeDomEvent(this.element,"keydown",this._onKeyDown),i.removeDomEvent(this.element,"blur",this._onBlur)},n.prototype._onFocus=function(){return this.focused=!0},n.prototype._onKeyPress=function(t){var e,i;return e=t.which||t.keyCode,this.visible&&13===e?(null!=(i=this.highlighted)&&i.selectItem(),t.preventDefault?t.preventDefault():t.returnValue=!1,!1):void 0},n.prototype._onKeyDown=function(t){var e,i;switch(e=t.which||t.keyCode){case 38:return this.visible&&this._moveHighlight(-1),!1;case 40:return this.visible&&this._moveHighlight(1),!1;case 9:if(this.visible)return null!=(i=this.highlighted)?i.selectItem():void 0;break;case 27:return this._hideResults();case 37:case 39:case 13:break;default:return null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(t){return function(){return t._getSuggestions()}}(this),400)}},n.prototype._onBlur=function(){return this.mouseDownOnSelect?void 0:(this.focused=!1,this._hideResults())},n.prototype._moveHighlight=function(t){var e,i,s;return e=null!=this.highlighted?this.results.indexOf(this.highlighted):-1,null!=(i=this.highlighted)&&i.unhighlight(),e+=t,-1>e?e=this.results.length-1:e>=this.results.length&&(e=-1),null!=(s=this.results[e])&&s.highlight(),this.element.value=null!=this.highlighted?this.highlighted.value:this._val},n.prototype._getSuggestions=function(){var t,e,i,s,n;if(this.enabled){if(this._val=this.element.value,this.error_content=null,""!==this._val){for(s=this.services,n=[],e=0,i=s.length;i>e;e++)t=s[e],n.push(t.search(this._val));return n}return this._hideResults()}},n.prototype._applyStyle=function(t,e){return this.output.style[t]=e},n.prototype._getPosition=function(){var t,e;for(e=this.element,t={top:e.offsetTop+e.offsetHeight,left:e.offsetLeft};e=e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft;return t},n.prototype._hideResults=function(){var t,e,i,s,n;for(this.visible=!1,this._applyStyle("display","none"),this.results=[],s=this.services,n=[],e=0,i=s.length;i>e;e++)t=s[e],n.push(t.results=[]);return n},n.prototype._displayResults=function(){var t;return this.visible=!0,t=this._getPosition(),this.options.container===document.body&&(this._applyStyle("left",""+t.left+"px"),this._applyStyle("top",""+t.top+"px")),this._applyStyle("display","block")},n.prototype._renderItem=function(t,e){var s;return s=document.createElement("li"),s.innerHTML=t,null!=e&&(s.className=e),i.addDomEvent(s,"mousedown",function(t){return function(){return t.mouseDownOnSelect=!0}}(this)),i.addDomEvent(s,"mouseup",function(t){return function(){return t.mouseDownOnSelect=!1}}(this)),s},n.prototype._renderFooter=function(){return this._renderItem(this.options.footer_content,this.options.footer_class)},n.prototype._renderEmpty=function(){return this._renderItem(this.options.empty_content,this.options.empty_class)},n.prototype._servicesReady=function(){var t,e,i,s,n;for(e=[],n=this.services,i=0,s=n.length;s>i;i++)t=n[i],e.push(t.ready);return e.indexOf(!1)<0},n.prototype.showResults=function(){var t,e,i,s,n,o,r,h,u;if(this._servicesReady()){for(this.results=[],this.output.innerHTML="",h=this.services,s=0,o=h.length;o>s;s++)i=h[s],this.results=this.results.concat(i.results);if(this.results.length){for(this.results=this.results.sort(function(t,e){return e.score-t.score}),this.results=this.results.slice(0,+(this.getOption("max_results")-1)+1||9e9),u=this.results,n=0,r=u.length;r>n;n++)e=u[n],this.output.appendChild(e.render());null!=this.options.footer_content&&""!==(t=this._renderFooter())&&this.output.appendChild(t),this._displayResults()}else this.error_content?(this.output.appendChild(this._renderItem(this.error_content,this.options.error_class)),this._displayResults()):(null!=this.options.empty_content?(this.output.appendChild(this._renderEmpty()),this._displayResults()):this._hideResults(),this.trigger("results:empty"));this.trigger("results:update")}},n.prototype.selectHighlighted=function(){this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},n}(i.Dispatch),i.Service=function(t){function n(t,i,s,n){this.widget=t,this.name=i,this.search_fn=s,this.options=null!=n?n:{},this._response=e(this._response,this),this.results=[],this.response=function(t){return function(){return t._response.apply(t,arguments)}}(this)}return s(n,t),n.prototype.search=function(t){return this.last_query=t,this.ready=!1,this.search_fn(t,this.response)},n.prototype._response=function(t,e){var s,n,o;if(this.results=[],this.last_query===t){for(this.results=[],n=0,o=e.length;o>n;n++)s=e[n],this.results.push(new i._Result(this,s));return this.ready=!0,this.widget.showResults()}},n}(i.Dispatch),i._Result=function(){function t(t,e){var i,s,n,o;this.service=t,this.options=e,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=null!=(i=this.options)?i.value:void 0,this.score=(null!=(s=this.options)?s.score:void 0)||0,this.identifier=null!=(n=this.options)?n.identifier:void 0,this.data=(null!=(o=this.options)?o.data:void 0)||{}}return t.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=null!=this.renderer?this.renderer(this.value,this.data):this.value,this.li.className=this.widget.options.item_class,this.addEvents(),this.li},t.prototype.addEvents=function(){return i.addDomEvent(this.li,"click",function(t){return function(e){return t.selectItem(),e.preventDefault?e.preventDefault():e.returnValue=!1}}(this)),i.addDomEvent(this.li,"mouseover",function(t){return function(){return t.highlight()}}(this)),i.addDomEvent(this.li,"mouseout",function(t){return function(){return t.unhighlight()}}(this)),i.addDomEvent(this.li,"mousedown",function(t){return function(){return t.widget.mouseDownOnSelect=!0}}(this)),i.addDomEvent(this.li,"mouseup",function(t){return function(){return t.widget.mouseDownOnSelect=!1}}(this))},t.prototype.selectItem=function(){return this.service.trigger("result:select",this.value,this.data),this.widget.highlighted=this,this.widget.selectHighlighted()},t.prototype.highlight=function(){var t;return null!=(t=this.widget.highlighted)&&t.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.options.hover_class,this.widget.highlighted=this},t.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(new RegExp(this.widget.options.hover_class,"gi"),"")},t}(),i})}).call(this);